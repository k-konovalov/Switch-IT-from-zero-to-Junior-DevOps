# 03.03 VCS - Работа с ветками

## Теория
- ветка: легковесная абстракция, часть структуры дерево. Хранит изменения отдельно от других веток.
- workflow - способ ведения веток
- HEAD: это символическое имя текущего выбранного коммита или коммит, над которым мы в данный момент работаем.
- merge: слияние или просто мердж. Слияния в Git создают особый вид коммита, который имеет сразу двух родителей. Коммит с двумя родителями обычно означает, что мы хотим объединить изменения из одного коммита с другим коммитом и всеми их родительскими коммитами.
- удалённые репозитории: копия репозитория, хранящиеся в другом месте
- Refspec: определения местоположения
- origin: именование удаленных веток, <удалённый репозиторий>/<имя ветки>

## Задание 1: создай несколько веток, попробуй переключиться между ними
- `git checkout`
  - -b: создать ветку
    - `git checkout -b your-branch-name`
  - `git checkout commit_hash`: Точное указание хеша (из git log)
    - полный: fed2da64c0efc5293610bdd892f82a58e8cbc5d8
    - сокращенно: fed2da64
  - `git checkout HEAD^`: Относительные ссылки
    - ^: перемещение на один коммит назад (оператор каретки)
      - main^ означает "первый родитель ветки main".
      - номер после ^ определяет, на какого из родителей мерджа надо перейти. По-умолчанию первый.
    - ^^: перемещение на два коммита назад
      - main^^ означает прародитель (родитель родителя) main
    - ~<num>: перемещение на несколько коммитов назад
    - можно использовать HEAD как относительную ссылку.
      - `git checkout HEAD^`
    - Возможны комбинации
      - `git checkout HEAD~^2~2`: на втором родителе прыгнуть на 2 коммита назад
    - `git checkout -b totallyNotMain o/main`: связывание локальной ветки с удаленной
      - `git branch -u o/main foo`: аналогично
- `git branch`: показать ветки
   - -f: прикрепить ветку к коммиту при помощи опции -f.
     - git branch -f main HEAD~3
   - --all: показать все ветки
   - --remote: показать удаленные
- `git cherry-pick <Commit1> <Commit2> <...>`: копирование нескольких коммитов на текущее место (HEAD)

### HEAD
HEAD всегда указывает на последний коммит из локального дерева. Большинство команд Git, изменяющих рабочее дерево, начнут с изменения HEAD.
Отделение (detaching) HEAD означает лишь присвоение его не ветке, а конкретному коммиту.

### Слияние фича-бранчей (веток)
Ведение работы в одной общей ветке неминуемо ведет к появлению конфликтов при push. Для разделения внесения изменений ввели понятие workflow.
Виды популярных worflow:
- Git Flow
  - main / release / hotfix / feature ветки
  - Плюсы: Позволяет жестко отделять то что находится в активной работе и то что уходит в продакшн.
  - Минусы: запутанный процесс взаимодействия веток
- Github Flow (ближе к TBD)
  - main / feature ветки
  - Плюсы: main всегда готов к выкатке, меньше веток
  - Минусы: необходимы множество настроенных проверок на старте (тесты, линтеры и т.п)

## Задание 2: Merge / Rebase, Fetch / Pull / Push
- `git clone`: клонирование удаленного репозитория (вместе с основной веткой) в локальный
- `git fetch`: синхронизирует локальное представление удалённых репозиториев с актуальными через протоколы http / git, без изменения текущих файлов.
  - `git fetch <источник>:<получатель>`: явно закачать коммиты в локальную ветку
- `git pull`: скачивание изменений с удаленной ветки и их применение к текущей ветке
  - `git pull --rebase`: позволяет разрешать конфликты приз агрузке изменений
- `git merge branch_name`: слияние двух родительских коммитов в один
- `git rebase branch_name`: копирует набор коммитов и переносит их в другое место
  - Преимущество rebase в том, что c его помощью можно делать чистые и красивые линейные последовательности коммитов. История коммитов будет чище, если применять rebase.
- `git rebase -i`: отбор коммитов для rebase, происходит открытие файла в редакторе типа vim и (drop, amend, squash и другие).
  - `git rebase -i HEAD~4`
  - Git Interactive Rebase
- `git push`: загрузка изменений в указанный удалённый репозиторий
  - `git push <удалённый_репозиторий> <целевая_ветка>`: классическое использование
  - `git push origin <источник>:<получатель>`: когда вам разделить источник и получатель аргумента <пункт назначения>
  - `git push --set-upstream origin some-feature`: когда удаленная ветка не создана
  - upstream:

### Rebase vs merge
За rebase:
Rebasing делает дерево коммитов более чистым и читабельным (единая линия), но явно изменяет историю коммитов в дереве.
Merge сохраняет историю, но ?.

## Задание 3: ЗаPush это в удаленный репозиторий (github.com, gitlab.com)
Работа с удалёнными git репозиториями сводится к передаче данных в и из других репозиториев.

### Удалённые репозитории в Git
Важные свойства:
- резервное копирование! 
- совместная работа
- визуализация работы

### Github
- Репозиторий и токен получен заране
- `git clone https://github.com/k-konovalov/study-git-creation.git`: клонирование удаленного репозитория
- `git checkout -b some-feature`: создаем локальную ветку
- `touch test2.txt`
- `git add --all`
- `git commit -m "some changes"`
- `git push --set-upstream origin some-feature`: создаем удаленную ветку и копируем в нее изменения

## Ссылки
- [Ветвление в Git - Управление ветками](https://git-scm.com/book/ru/v2/%D0%92%D0%B5%D1%82%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2-Git-%D0%A3%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2%D0%B5%D1%82%D0%BA%D0%B0%D0%BC%D0%B8)
- [Navigating Branches](https://gitimmersion.com/lab_25.html)
- [Gits | Reset repository](https://gist.github.com/heiswayi/350e2afda8cece810c0f6116dadbe651)
