# 02.04 Unix utils - Переменные окружения

## Теория
Место, в котором оболочка держит пути всех настроек, называется **окружением**.  
В Unix реализовано как строка, состоящая из пары ключ-значение. `KEY=value1:value2:"value with spaces":...`
**Переменные окружения** 
Это переменные, определенные для текущей оболочки — они наследуются любым потомком оболочки и запущенного процесса. 
Эти переменные используются, чтобы пропускать информацию в процессы, которые образуются от самой оболочки.
  
**Переменные оболочки** 
Это переменные, которые содержатся исключительно в оболочке, где они были определены или установлены. 
Они часто используются для хранения путей, например, как текущая рабочая директория.

- Наследование: Дочерние процессы наследуют переменные родителя.
- Замена: дочерняя оболочка заменяет одинаковые переменные родителя.
- Нейминг: uppercase
- Безопасность: Эти переменные доступны не только для системных приложений.

**Команды**:
- print / env : вывод переменных окружения
  - print {переменная}: вывод значения конкретной переменной
- set: установка переменных оболочки
- `echo $TEST_VAR`: вывод переменной
- `export NEW_VAR="Testing export"`: перенос в переменную окружения
  - -n: удаление
- export: временное назначение переменных в текущей сессии
- source: для применения изменений в текущей сессии или для всех пользователей, если переменная создана в системном файле конфигурации.
- unset: удаление переменных оболочки (в текущей сессии)
- which {переменная}: узнать путь для исполняемого файла из PATH

**Иерархия наследования**:
- переменная оболочки (текущий терминал) / локальные переменные
  - `TEST_VAR='Hello World!'`
  - `set | grep TEST_VAR`: просмотр переменной оболочки
- переменная окружения
- переменная пользователя
  -  `~/.bashrc`, `~/.zprofile`
- системная переменная
  - `/etc/profile`, `/etc/bash.bashrc` или `/etc/environment`.

**Виды сессий**:
- login сеccия: вход в терминал под пользователем или под SSH
  -  Порядок просмотра: `/etc/profile` ->  `~/.bash_profile`, `~/.bash_login` и `~/.profile`.
- не логин сессия: если начинается новая сессия bash-оболочки в пределах аутентифицированной сессии,
  - Порядок просмотра: ` /etc/bash.bashrc` -> `~/.bashrc`
- интерактивная \ не интерактивная сессия: прикрепляется \ не прикрепляется к терминалу
  - Порядок просмотра: файл из переменной `BASH_ENV`

Пример сессий:
- Обычная сессия, начинающаяся с SSH, обычно является интерактивной оболочкой с логином. 
- Скрипты, запускающиеся из командной строки, обычно являют собой не-интерактивной и не-логин оболочкой. 
- Терминальная сессия может быть составлена из любых комбинаций этих двух свойств

**Некоторые общие переменные окружения**:
- SHELL: отображает путь к оболочке, занимающаяся интерпретацией тех или иных команд, которые вводит пользователь. Как правило, по умолчанию, это будет интерпретатор bash, но возможно и применение других значений, которые можно указать.
- TERM: указывает тип терминала, который эмулируется, когда запускается консольная оболочка. Могут эмулироваться различные терминалы для необходимых операционных требований.
- USER: имя текущего пользователя оболочки.
- PWD: переменная отображает значение текущей рабочей директории.
- OLDPWD: предыдущая рабочая директория. Оболочка держит эту переменную для обратного переключения, когда запускается команда cd -.
- LS_COLORS: определяет цвет кодов, которые используются для вывода команды ls. Чтобы различать типы файлов и директорий.
- MAIL: отображает электронную почту текущего пользователя.
- PATH: список директорий, которые будет проверять система, когда будет идти обращение к той или иной команде. Когда пользователь вводит команду, система смотрит указанные директории, в последовательном порядке.
- LANG: текущий язык и локализационные настройки, включая кодировку символов.
- HOME: текущая домашняя директория пользователя.
_: отображает вывод последней запущенной команды.
  
**Некоторые переменные оболочки**:
- BASHOPTS: список опций, которые используются при запуске bash. Это может быть полезно для выяснения, каким конкретно способом будет оперировать консольная оболочка.
- BASH_VERSION: отображает конкретную версию bash.
- BASH_VERSINFO: мажорная версия bash.
- COLUMNS: число колон, используемых для отображения вывода в оболочке.
- DIRSTACK: директории, которые доступны для команд pushd и popd.
- HISTFILESIZE: количество линий, хранящиеся в файле истории набранных команд.
- HISTSIZE: количество линий, которые можно хранить в памяти.
- HOSTNAME: имя компьютера системы на данный момент.
- IFS: внутренний разделитель поля в командной строке. По умолчанию — это пробел.
- PS1: строка приглашения на ввод. Эта переменная используется для того, чтобы определить, как будет выглядеть эта строка. Еще есть вторая строка PS2 которая используется, когда команда многострочная.
- SHELLOPTS: опции оболочки, которые можно определять с помощью команды set.
- UID: идентификатор текущего пользователя.

## Задание 1: создай переменные окружения и попробуй их вывести в echo
Чаще всего указываются ~/.bashrc.
```Bash
# Переменная доступна только для текущего сеанса терминала:
MSG="hello echo"
echo $MSG

# Необходим перезапуск сессии терминала,
# но переменная доступна для всех дочерних процессов
export MSG=hello

# Чтобы сделать переменную доступной после перезагрузки операционной системы,
# необходимо добавить ее объявление в соответствующий файл конфигурации вашей оболочки
# .bashrc для Bash
echo 'export MSG=hello' >> ~/.bashrc
source ~/.bashrc

# .zshrc для Zsh
echo 'export MSG=hello' >> ~/.zshrc
source ~/.zshrc
```

## Задание 2: что значит разные места хранения переменных окружения системные / пользователя / программы
Разграничение области видимости, безопасность.

### Системные переменные
Нужны, чтобы все пользователи имели доступ к одинаковым переменным. Пример: 
- настройка системы: 
- указание путей поиска: PATH — это системная переменная, которую операционная система использует для того, чтобы найти нужные исполняемые объекты в командной строке или окне терминала.
- хранение глобальной конфигурации

### Пользовательские переменные                                                  
Нужны для настроек конкретного пользователя или перезаписать системные. Разные пути к конфигам, к исполняемым файлам и т.п.  
Помещая часть настроек в окружение, мы можем не настраивать каждое приложение по отдельности.  
Пример: 
- HOME / PWD: текущий рабочий каталог / путь к директории пользователя
- API ключи
- SSH ключи
- пароль к БД
- настройка поведения программ

### Программы: .env
Файл .env — это обычный текстовый файл без расширения с именем .env, каждая строка которого представляет собой пару ключ=значение.  
Программы считывают его в свою область видимости. Важно исключать его из VCS. Хорошим тоном считается наличие `.env.example`.
```Bash
DB_HOST=local_db_host
DB_PORT=local_db_port
DB_NAME=local_db_name
DB_USER=local_db_user
DB_PASSWORD=local_db_password
```
Использование .env в различных языках: 
```Python3
import os
from dotenv import load_dotenv

load_dotenv()

db_host = os.getenv("DB_HOST")
```
```javascript
/*
Установим библиотеку dotenv при помощи пакетного менеджера:
npm install dotenv
или
yarn add dotenv
*/

const dotenv = require('dotenv');
dotenv.config();

const dbHost = process.env.DB_HOST;

// node --env-file=.env app.js // v20+
```
```Golang
/*
Установим пакет github.com/joho/godotenv с помощью go get
go get github.com/joho/godotenv
*/

package main

import (
	"github.com/joho/godotenv"
	"os"
)
func main() {
	err := godotenv.Load()

    if err != nil {
        log.Fatalf("Error loading .env file")
    }

	dbHost := os.Getenv("DB_HOST")
}
```
## Ссылки
- [Как читать и определять переменные окружения и оболочки на Linux](https://ru.hexlet.io/blog/posts/kak-chitat-i-opredelyat-peremennye-okruzheniya-i-obolochki-na-linux)
- [Переменные окружения для начинающих разработчиков](https://habr.com/ru/companies/gnivc/articles/792082/)
- [Переменные окружения в Linux: как посмотреть, установить и сбросить](https://wiki.merionet.ru/articles/peremennye-okruzheniya-v-linux-kak-posmotret-ustanovit-i-sbrosit)
- 